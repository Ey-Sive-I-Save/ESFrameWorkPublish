# ES 框架安装管理器

## 概述

ES Installer 是一个商业级的Unity插件安装管理工具，用于管理和安装ES框架及其所有依赖项。

## 功能特性

### 🔧 插件依赖管理
- 支持Unity Package Manager (UPM) 插件管理
- 自动检查插件安装状态
- 批量安装和验证插件依赖
- 支持必需和可选依赖分类

### 📦 Package依赖管理
- 支持外部Package下载和验证
- 文件大小显示和下载进度
- **本地路径自动管理** - 所有下载的文件都保存在当前文件夹的`Downloads`子文件夹中
- 批量下载功能

### 🚀 智能安装流程
- 依赖验证前置检查
- Unity Package自动导入
- 安装状态实时监控
- 详细的安装报告生成

### 💾 配置持久化
- **JSON格式配置自动保存** - 配置文件保存在当前文件夹中
- 多配置档案支持
- 自动备份和恢复
- 配置导入导出功能

### 🔍 自动检查功能

ES Installer 提供了智能的自动检查功能，可以在Unity编辑器启动时自动检测依赖状态：

#### 功能特性
- **启动时检查**: 每次打开Unity编辑器时自动检查所有必需依赖
- **智能提醒**: 发现未安装依赖时弹出用户友好的提醒对话框
- **用户控制**: 可以选择立即安装或稍后提醒
- **可配置**: 支持启用/禁用自动检查功能

#### 配置选项
- **启用编辑器启动时自动检查**: 控制是否在编辑器启动时执行依赖检查（默认启用）
- **跳过下次自动检查**: 临时跳过下一次自动检查，适用于需要暂时忽略依赖检查的场景

#### 工作流程
1. **编辑器启动**: Unity编辑器加载时自动触发检查
2. **依赖验证**: 检查所有必需的插件和Package依赖
3. **状态判断**: 如果发现未安装的必需依赖，显示提醒
4. **用户选择**: 
   - **立即安装**: 打开安装管理器界面
   - **稍后提醒**: 延迟到下次编辑器操作时提醒
5. **依赖解决**: 用户通过安装管理器解决依赖问题

#### 优势
- **及时发现**: 在开发过程中及时发现依赖问题
- **用户友好**: 非侵入式的提醒方式
- **灵活控制**: 用户可以完全控制检查行为
- **性能优化**: 只检查必需依赖，避免不必要的操作

## 文件夹结构

安装器采用自包含设计，所有相关文件都保存在当前文件夹中：

```
ES_Installer/
├── ESInstaller.cs                    # 主安装器代码
├── ESInstaller_Config.json          # 配置文件（自动生成）
├── Downloads/                       # 下载文件存放目录（自动创建）
│   ├── package1.zip                # 下载的Package文件
│   ├── package2.zip                # 下载的Package文件
│   └── ES_Framework_Package.unitypackage  # Unity Package文件
├── ES_Installation_Report_*.txt    # 安装报告（自动生成）
├── README.md                        # 使用文档
└── ESInstaller_Config_Example.json  # 示例配置文件
```

## 打包说明

由于安装器采用自包含设计，您只需要：

1. **打包整个文件夹**：将包含`ESInstaller.cs`的整个文件夹打包
2. **分发时包含所有文件**：
   - 安装器脚本文件
   - 配置文件（如果有自定义配置）
   - Downloads文件夹（如果有预下载的Package）
   - 文档文件

用户收到安装包后，只需要将整个文件夹放入Unity项目的相应位置即可使用。

## 使用方法

### 1. 打开安装管理器
在Unity编辑器中选择：`ES > 安装管理器`

### 2. 配置依赖项

#### 添加插件依赖
1. 在"插件依赖"部分点击"➕ 添加插件依赖"
2. 填写以下信息：
   - **名称**: 插件显示名称
   - **版本**: 插件版本号
   - **描述**: 插件功能描述
   - **Package ID**: Unity Package Manager包ID (例如: `com.unity.textmeshpro`)
   - **检查类名**: 可选，用于通过完整类名验证安装状态 (例如: `Whisper.WhisperManager`)
   - **安装URL**: 可选的手动安装URL

#### 插件依赖智能检查
安装器采用智能的插件依赖检查策略：

- **类检查优先**: 如果设置了检查类名，优先通过反射检查指定类是否存在
- **UPM备用**: 如果类检查失败或未设置，使用Unity Package Manager检查
- **精确验证**: 通过实际类存在性验证安装状态

**检查流程**:
1. 如果设置了检查类名，扫描程序集查找指定类
2. 如果找到类，标记为已安装
3. 如果未找到或未设置类，使用UPM检查包是否已安装

#### 添加Package依赖
1. 在"Package依赖"部分点击"➕ 添加Package依赖"
2. 填写以下信息：
   - **名称**: Package显示名称
   - **URL**: 下载地址
   - **描述**: Package功能描述
   - **本地路径**: 自动设置为`Downloads`文件夹中的相应文件名

#### Package依赖智能检查
安装器采用智能的Package依赖检查策略：

- **本地优先**: 优先检查本地文件是否存在和完整性
- **文件完整性**: 通过文件大小验证下载文件的完整性
- **网络容错**: 支持HEAD和GET请求，适应不同服务器配置
- **超时保护**: 15秒超时，避免长时间等待
- **离线友好**: 网络失败时仍可使用本地文件状态

**检查流程**:
1. 检查本地文件是否存在
2. 验证文件大小是否与服务器一致
3. 如需要，尝试HEAD请求获取文件信息
4. 如HEAD不支持，尝试范围GET请求
5. 根据结果更新下载状态和文件大小

### 3. 验证依赖
- 点击"🔍 检查所有依赖"验证所有插件状态
- 点击"🔍 检查所有Package"验证所有Package状态
- 或者单独检查每个依赖项

### 4. 安装依赖
- 点击"📦 安装所有依赖"批量安装插件
- 点击"📥 下载所有Package"批量下载Package
- 或者单独安装每个依赖项

### 5. 执行安装
1. 设置Unity Package路径（自动指向Downloads文件夹）
2. 确认所有依赖状态为"✓ 所有依赖有效"
3. 点击"🚀 开始安装 ES 框架"
4. 等待Unity完成Package导入

## 配置管理

### 保存配置
- 点击"💾 保存配置"将当前设置保存到`ESInstaller_Config.json`文件
- 配置文件自动保存在当前文件夹中

### 加载配置
- 点击"📂 加载配置"从JSON文件加载设置

### 重置配置
- 点击"🔄 重置为默认"恢复默认配置

## 高级功能

### 安装报告
- 点击"📋 生成安装报告"创建详细的安装状态报告
- 报告自动保存在`Downloads`文件夹中

### 状态刷新
- 点击"🔄 刷新状态"重新检查所有依赖状态

### 帮助系统
- 点击"❓ 帮助"查看详细的使用说明

### 测试功能
安装器提供了测试功能来验证自动检查功能：

#### 测试自动检查
- 在Unity编辑器中选择：`ES Framework > Test Auto Check`
- 此功能模拟编辑器启动时的自动检查过程
- 用于验证自动检查逻辑是否正常工作

#### 测试配置加载
- 在Unity编辑器中选择：`ES Framework > Test Config Load`
- 验证配置文件加载功能
- 显示当前配置的自动检查设置状态

## 依赖项格式

### 插件依赖JSON格式
```json
{
  "name": "TextMeshPro",
  "version": "3.0.6",
  "description": "Unity文本渲染系统，提供高质量的文本显示功能",
  "isRequired": true,
  "isInstalled": false,
  "installUrl": "",
  "packageId": "com.unity.textmeshpro"
}
```

### Package依赖JSON格式
```json
{
  "name": "ES Framework Core",
  "url": "https://example.com/es-core.zip",
  "description": "ES框架核心组件，包含基础功能和工具",
  "isRequired": true,
  "isDownloaded": false,
  "localPath": "Downloads/es-core.zip",
  "fileSize": 0
}
```

## 注意事项

1. **依赖验证**: 安装前务必完成所有依赖检查
2. **网络连接**: Package下载需要稳定的网络连接
3. **磁盘空间**: 确保有足够的磁盘空间存储下载的Package
4. **Unity版本**: 确保使用的Unity版本与插件兼容
5. **备份**: 安装前建议备份重要数据

## 自包含优势

- **无需外部依赖**: 所有文件都保存在本地文件夹中
- **便于分发**: 只需打包一个文件夹即可
- **配置隔离**: 不同项目的配置相互独立
- **文件管理**: 下载的文件自动组织在Downloads文件夹中
- **版本控制友好**: 所有相关文件都可以纳入版本控制

## 故障排除

### 插件安装失败
- 检查Package ID是否正确
- 确认网络连接正常
- 查看Unity控制台错误信息

### Package下载失败
- 验证URL是否可访问
- 检查本地路径权限
- 确认磁盘空间充足

### 配置加载失败
- 检查JSON文件格式是否正确
- 确认文件路径存在
- 尝试重置为默认配置

## 技术支持

如遇到问题，请：
1. 查看Unity控制台错误信息
2. 生成安装报告并查看详细状态
3. 联系技术支持团队

---

**版本**: 1.0.0
**最后更新**: 2026-01-17
2. 填写以下信息：
   - **名称**: Package显示名称
   - **URL**: 下载地址
   - **描述**: Package功能描述
   - **本地路径**: 下载后保存位置

### 3. 验证依赖
- 点击"🔍 检查所有依赖"验证所有插件状态
- 点击"🔍 检查所有Package"验证所有Package状态
- 或者单独检查每个依赖项

### 4. 安装依赖
- 点击"📦 安装所有依赖"批量安装插件
- 点击"📥 下载所有Package"批量下载Package
- 或者单独安装每个依赖项

### 5. 执行安装
1. 设置Unity Package路径
2. 确认所有依赖状态为"✓ 所有依赖有效"
3. 点击"🚀 开始安装 ES 框架"
4. 等待Unity完成Package导入

## 配置管理

### 保存配置
- 点击"💾 保存配置"将当前设置保存到JSON文件
- 配置文件位置：`Assets/Plugins/ES/Editor/Installer/ESInstaller_Config.json`

### 加载配置
- 点击"📂 加载配置"从JSON文件加载设置

### 重置配置
- 点击"🔄 重置为默认"恢复默认配置

## 高级功能

### 安装报告
- 点击"📋 生成安装报告"创建详细的安装状态报告
- 报告包含所有依赖状态和安装信息

### 状态刷新
- 点击"🔄 刷新状态"重新检查所有依赖状态

### 帮助系统
- 点击"❓ 帮助"查看详细的使用说明

## 依赖项格式

### 插件依赖JSON格式
```json
{
  "name": "TextMeshPro",
  "version": "3.0.6",
  "description": "Unity文本渲染系统",
  "isRequired": true,
  "isInstalled": false,
  "installUrl": "",
  "packageId": "com.unity.textmeshpro"
}
```

### Package依赖JSON格式
```json
{
  "name": "ES Framework Core",
  "url": "https://example.com/es-core.zip",
  "description": "ES框架核心组件",
  "isRequired": true,
  "isDownloaded": false,
  "localPath": "Assets/Downloads/es-core.zip",
  "fileSize": 0
}
```

## 注意事项

1. **依赖验证**: 安装前务必完成所有依赖检查
2. **网络连接**: Package下载需要稳定的网络连接
3. **磁盘空间**: 确保有足够的磁盘空间存储下载的Package
4. **Unity版本**: 确保使用的Unity版本与插件兼容
5. **备份**: 安装前建议备份重要数据

## 故障排除

### 插件安装失败
- 检查Package ID是否正确
- 确认网络连接正常
- 查看Unity控制台错误信息

### Package下载失败
- 验证URL是否可访问
- 检查本地路径权限
- 确认磁盘空间充足

### 配置加载失败
- 检查JSON文件格式是否正确
- 确认文件路径存在
- 尝试重置为默认配置

## 技术支持

如遇到问题，请：
1. 查看Unity控制台错误信息
2. 生成安装报告并查看详细状态
3. 联系技术支持团队

---

**版本**: 1.0.0
**最后更新**: 2026-01-17