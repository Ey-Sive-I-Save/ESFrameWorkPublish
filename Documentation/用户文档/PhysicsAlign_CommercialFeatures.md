# 智能对齐与分布工具 - 商业级功能说明

## 📋 概述
这是一个功能完整的**商业级**Unity编辑器工具，提供专业的对象对齐、分布和尺寸匹配功能。完全支持3D对象、2D精灵和UI元素（RectTransform）。

---

## ✨ 核心特性

### 1. **完整的深度对齐功能**
#### 基础深度对齐（Z轴）
- ✅ **前对齐（近）** - 将对象对齐到最近位置（Z轴最小值）
- ✅ **后对齐（远）** - 将对象对齐到最远位置（Z轴最大值）
- ✅ **深度居中** - 将对象在Z轴上居中对齐

#### 镜头相对深度对齐
- ✅ **镜头前对齐** - 相对于Scene视图相机的前方对齐
- ✅ **镜头后对齐** - 相对于Scene视图相机的后方对齐
- ✅ **镜头深度居中** - 相对于相机的深度居中

**使用场景**：
- 3D场景中的前后排列
- UI层级深度管理
- 相机视角的深度布局

---

### 2. **完善的RectTransform支持**

#### UI专用边界计算
```csharp
✓ 精确的世界坐标转换
✓ 4个角点的完整边界包围
✓ 中心点精确计算
✓ 子对象边界聚合
✓ 活跃状态自动过滤
```

#### UI尺寸匹配
- **宽度匹配**：使用 `SetSizeWithCurrentAnchors(Horizontal)`
- **高度匹配**：使用 `SetSizeWithCurrentAnchors(Vertical)`
- **深度匹配**：支持UI元素的Z轴缩放（localScale.z）
- **混合模式**：UI对象可以参考3D对象的尺寸

#### 增强功能
```csharp
✓ 锚点保持：尺寸调整时保持锚点设置
✓ 子对象支持：可选包含子UI元素的边界
✓ Canvas适配：自动处理不同Canvas模式
✓ 批量处理：同时处理多个UI元素
```

---

### 3. **商业级尺寸匹配系统**

#### 智能匹配逻辑
```csharp
匹配优先级：
1. matchScale（整体缩放） - 最高优先级，会覆盖单独匹配
2. 单独尺寸匹配（宽/高/深）
3. 旋转匹配
```

#### 边界零值处理
```csharp
✓ 自动检测：当对象边界为零时自动切换策略
✓ Scale直接复制：对于空边界使用localScale直接匹配
✓ 容错性：避免除以零错误
✓ 智能回退：自动选择最佳匹配方式
```

#### 混合对象支持
- ✅ UI → 3D：UI元素可以参考3D对象尺寸
- ✅ 3D → UI：3D对象可以参考UI元素尺寸
- ✅ 2D → 3D：2D精灵与3D对象互相参考
- ✅ 智能转换：自动处理不同坐标系统

---

## 🎯 商业级增强

### 1. **专业级错误提示**

#### 对齐功能提示
```
❌ 未选中任何对象
请在场景或层级视图中选择至少2个GameObject

❌ 选中对象不足
对齐功能需要至少2个对象
当前有效选中：1个对象

💡 提示：请检查对象是否被锁定或未激活
```

#### 分布功能提示
```
❌ 选中对象不足
分布功能需要至少2个对象
当前有效选中：1个对象

💡 提示：
• 检查对象是否被锁定或未激活
• 建议选择3个或以上对象以获得更好的分布效果
```

#### 匹配功能提示
```
❌ 未选择任何匹配选项
请至少勾选一个匹配选项：
• 匹配宽度(X轴)
• 匹配高度(Y轴)
• 匹配深度(Z轴)
• 匹配旋转角度
• 匹配整体缩放

❌ 无法获取参考对象
请检查选择设置和对象状态
```

### 2. **详细的功能说明**

#### 尺寸匹配选项详解
```
📏 尺寸匹配选项（精确控制）：

• 宽度(X)：水平尺寸，3D对象通过Scale调整，UI对象调整RectTransform
• 高度(Y)：垂直尺寸，智能识别边界类型
• 深度(Z)：纵深尺寸，支持3D对象和UI的Z轴缩放
• 边界为零时自动使用Scale直接匹配
```

#### 参考对象选择说明
```
📌 参考对象选择规则：

• 第一个选中：使用首个选择的对象作为参考
• 最后选中：使用最后选择的对象作为参考
• 父对象中心：使用共同父对象作为参考
```

### 3. **完整的功能文档**

#### InfoBox信息提示
- ✅ 每个功能区都有详细说明
- ✅ 参数含义和使用场景
- ✅ 注意事项和最佳实践
- ✅ 常见问题和解决方案

---

## 🔧 技术实现细节

### RectTransform边界计算
```csharp
// 精确计算4个角点的世界坐标
var corners = new Vector3[4];
rectTransform.GetWorldCorners(corners);

// 计算真实中心点（4个角的平均值）
Vector3 center = Vector3.zero;
foreach (var corner in corners)
    center += corner;
center /= 4f;

// 创建边界并扩展到所有角
bounds = new Bounds(center, Vector3.zero);
foreach (var corner in corners)
    bounds.Encapsulate(corner);
```

### UI尺寸匹配
```csharp
// 保持锚点的尺寸设置
if (matchWidth) 
{
    rectTransform.SetSizeWithCurrentAnchors(
        RectTransform.Axis.Horizontal, 
        referenceRect.rect.width
    );
}

// UI深度支持（Z轴缩放）
if (matchDepth)
{
    var scale = rectTransform.localScale;
    scale.z = referenceRect.localScale.z;
    rectTransform.localScale = scale;
}
```

### 边界零值处理
```csharp
// 检测边界是否为零
bool useDirectScale = objectBounds.size.magnitude < 0.001f;

if (matchWidth)
{
    if (useDirectScale || objectBounds.size.x == 0)
        scale.x = referenceTransform.localScale.x; // 直接复制
    else
        scale.x *= referenceBounds.size.x / objectBounds.size.x; // 比例计算
}
```

---

## 📊 功能对比表

| 功能 | 支持状态 | 3D对象 | UI元素 | 2D精灵 |
|------|---------|--------|--------|--------|
| 左右对齐 | ✅ 完整 | ✅ | ✅ | ✅ |
| 上下对齐 | ✅ 完整 | ✅ | ✅ | ✅ |
| **前后对齐** | ✅ **新增** | ✅ | ✅ | ✅ |
| 水平居中 | ✅ 完整 | ✅ | ✅ | ✅ |
| 垂直居中 | ✅ 完整 | ✅ | ✅ | ✅ |
| **深度居中** | ✅ **新增** | ✅ | ✅ | ✅ |
| 相机对齐 | ✅ 完整 | ✅ | ✅ | ✅ |
| 均匀分布 | ✅ 完整 | ✅ | ✅ | ✅ |
| 间距分布 | ✅ 完整 | ✅ | ✅ | ✅ |
| 宽度匹配 | ✅ 完整 | ✅ | ✅ | ✅ |
| 高度匹配 | ✅ 完整 | ✅ | ✅ | ✅ |
| **深度匹配** | ✅ **增强** | ✅ | ✅ | ✅ |
| 旋转匹配 | ✅ 完整 | ✅ | ✅ | ✅ |
| 缩放匹配 | ✅ 完整 | ✅ | ✅ | ✅ |
| **混合对象** | ✅ **新增** | ✅ | ✅ | ✅ |
| **零边界处理** | ✅ **新增** | ✅ | ✅ | ✅ |

---

## 🚀 使用示例

### 示例1：UI布局深度管理
```csharp
场景：调整UI元素的前后层级关系

1. 选择多个UI按钮
2. 选择"深度对齐"→"前对齐（近）"
3. 所有按钮对齐到最前层
4. 使用"深度间距分布"调整层级间距
```

### 示例2：3D对象尺寸统一
```csharp
场景：统一多个道具模型的尺寸

1. 选择参考模型 + 目标模型
2. 设置参考对象为"第一个选中"
3. 勾选"匹配宽度"+"匹配高度"+"匹配深度"
4. 执行匹配，所有道具尺寸统一
```

### 示例3：UI与3D混合匹配
```csharp
场景：让UI框的尺寸匹配3D对象的投影

1. 选择3D对象（参考） + UI框架
2. 边界计算模式：Renderer
3. 勾选"匹配宽度"+"匹配高度"
4. UI框架自动调整为3D对象的屏幕投影尺寸
```

---

## ⚙️ 高级特性

### 1. 边界计算模式
- **自动检测**：智能选择最佳计算方式
- **Renderer**：基于渲染器边界
- **Collider**：基于碰撞器边界
- **RectTransform**：UI专用精确计算
- **TransformOnly**：仅使用Transform位置

### 2. 坐标系统
- **世界坐标**：全局坐标系统
- **局部坐标**：相对父对象
- **相对镜头**：基于Scene视图相机

### 3. 过滤选项
- **包含子对象**：计算整体边界
- **仅活跃对象**：跳过未激活对象
- **忽略锁定对象**：保护重要对象
- **操作后选中**：保持选中状态

---

## 💡 最佳实践

### 1. UI布局
```
✓ 使用RectTransform模式获得最精确的边界
✓ 深度匹配调整UI层级关系
✓ 相机对齐创建视角相关布局
✓ 保持锚点设置不变
```

### 2. 3D场景
```
✓ 使用Renderer模式处理复杂模型
✓ 深度对齐控制前后关系
✓ 均匀分布创建整齐排列
✓ 混合匹配统一不同类型对象
```

### 3. 性能优化
```
✓ 关闭"包含子对象"处理简单对象
✓ 使用"仅活跃对象"减少计算量
✓ 批量操作使用预览功能
✓ 大量对象分批处理
```

---

## 🎨 UI布局优化

### 视觉设计
- ✅ 清晰的功能分组（基础对齐/智能分布/尺寸匹配）
- ✅ 直观的按钮图标（← → ↑ ↓ ◀ ▶）
- ✅ 颜色编码区分功能类型
- ✅ 信息提示框突出重点

### 操作流程
- ✅ 一键快捷操作
- ✅ 参数实时调整
- ✅ 预览确认机制
- ✅ 完整撤销支持

---

## 📈 版本特性

### 当前版本：商业级 v1.0
```
✅ 完整的深度对齐功能
✅ 完善的RectTransform支持
✅ 商业级尺寸匹配系统
✅ 专业级错误提示
✅ 详细的功能文档
✅ 混合对象支持
✅ 零边界智能处理
✅ 子对象聚合计算
```

---

## 🔍 测试清单

### 功能测试
- [x] 所有对齐模式（18种）
- [x] 所有分布模式（12种）
- [x] 尺寸匹配（5种选项）
- [x] RectTransform专用计算
- [x] 混合对象匹配
- [x] 边界零值处理

### 边界情况
- [x] 单个对象选择（正确提示）
- [x] 未选择匹配选项（正确提示）
- [x] 锁定对象过滤
- [x] 未激活对象过滤
- [x] 空边界对象处理
- [x] 子对象递归计算

### 用户体验
- [x] 错误提示清晰
- [x] 功能说明完整
- [x] 操作流畅直观
- [x] 撤销功能正常

---

## 📞 技术支持

如有问题或建议，请参考以下资源：
- 工具界面的InfoBox提示
- 错误提示对话框
- 本文档的使用示例
- Unity Console的详细日志

---

**文档生成时间**：2026年1月18日  
**工具版本**：Commercial Grade v1.0  
**支持Unity版本**：2021.3.16f1+
